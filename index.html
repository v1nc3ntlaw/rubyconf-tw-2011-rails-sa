<!DOCTYPE html>

<!--
  Google HTML5 slide template

  Authors: Luke Mahé (code)
           Marcin Wichary (code and design)
           
           Dominic Mazzoni (browser compatibility)
           Charles Chen (ChromeVox support)

  URL: http://code.google.com/p/html5slides/
-->

<!--
  Ruby Conf Taiwan 2011/8/26-27
  Subject: Rails SA Practice
  Speaker: Sheng-Zhe Lin (v1nc3ntlaw)
  Twitter: @v1nc3ntlaw
    Gmail: v1nc3ntlaw@gmail.com
-->

<html>
  <head>
    <title>Rails SA Practice</title>

    <meta charset='utf-8'>
    <script
      src='slides.js'></script>
  </head>
  
  <style>
    body h1.upper {
      margin-top: 100px;
    }
    body h3 {
      font-size: 36px;
    }
    body span.smaller {
      font-size: 24px;
    }
    /* powered-by-rails */
    article.powered-by-rails .techbang-logo-big {
      margin-top: 30px;
      float: left;
    }
    article.powered-by-rails .side-logo {
      margin-top: 30px;
      margin-left: 350px;
    }
    article.powered-by-rails ul {
      margin-top: 8px;
      margin-left: 372px;
    }
    article.powered-by-rails div.source {
      top: 600px;
    }
  </style>

  <body style='display: none'>

    <section class='slides layout-regular template-default'>

      <article class='biglogo'>
        <h1>Rails SA Practice</h1>
        <p>
        Sheng-Zhe Lin<br>
        Ruby Conf Taiwan<br>
        August 27, 2011
        </p>
      </article>

      <article>
        <h1>about.me/v1nc3ntlaw</h1>
        <p>Sheng-Zhe Lin 林聖哲</p>
        <p>Rails developer and linux system administrator at Techbang.</p>
      </article>

      <article class="powered-by-rails">
        <h3>Powered by Rails</h3>
        <div class="techbang-logo-big">
          <img src="images/techbang-logo-big.png">
        </div>
        <div class="digiphoto-logo-50 side-logo">
          <img src="images/digiphoto-logo-50.gif">
        </div>
        <div class="playgame-logo side-logo">
          <img src="images/playgame-logo.png">
        </div>
        <div class="t17-logo side-logo">
          <img src="images/t17-logo.png">
        </div>
        <ul>
          <li>Advertise System</li>
          <li>Single Sign On (SSO)</li>
          <li>Events</li>
        </ul>
        <div class="source">
          http://www.techbang.com.tw<br/>
          http://digiphoto.techbang.com.tw<br/>
          http://game.techbang.com.tw<br/>
          http://t17.techbang.com.tw<br/>
        </div>
      </article>

      <article>
        <h1>Rails Production Server</h1>
        <ul>
          <li>Ubuntu (LTS) / Debian (Stable)</li>
          <li>Ruby Enterprise Edition (1.8.7)</li>
          <li>
            Nginx + Passenger<br/>
            <span class="smaller">passenger-install-nginx-module</span>
          </li>
        </ul>
        <div class="source">
          https://github.com/jnstq/rails-nginx-passenger-ubuntu<br/>
          http://www.rubyenterpriseedition.com/
        </div>
      </article>

      <article>
        <h1>Rails and Server Monitoring</h1>
      </article>

      <article>
        <h3>New Relic</h3>
        <div class="source">
          http://newrelic.com/
        </div>
      </article>

      <article>
        <h3>Scout</h3>
        <div class="source">
          https://scoutapp.com/
        </div>
      </article>

      <article>
        <h1>Open Source Solution</h1>
        <p>Nagios + Cacti</p>
      </article>

      <article>
        <h3>Nagios</h3>
        <p>services current status, unusual situation or crash alert</p>
        <p><img src="images/nagios-irc-alert-6d1x.png"></p>
        <div class="source">
          http://www.nagios.org/
        </div>
      </article>

      <article>
        <h3>Cacti</h3>
        <p>devices data graphing solution</p>
        <ul>
          <li>
            CPU Usage<br/>
            <img src="images/cacti-cpu-usage-85jq.png" width="408" height="170">
          </li>
          <li style="float: left;">
            Disk IO<br/>
            <img src="images/cacti-disk-io-29jh.png" width="204" height="85">
          </li>
          <li style="float: left; margin-left: 50px;">
            Memory Usage<br/>
            <img src="images/cacti-memory-usage-84h1.png" width="204" height="85">
          </li>
        </ul>
        <div class="source">
          http://www.cacti.net/
        </div>
      </article>

      <article>
        <h1>God</h1>
        <p>save me</p>
        <div class="source">
          http://rubygems.org/gems/god
        </div>
      </article>

      <article>
        <h1>Nginx and Passenger Tuning</h1>
      </article>

      <article>
        <h3>Nginx and Passenger Configuration</h3>
      </article>

      <article>
        <h3>Nginx upload module</h3>
        <div class="source">
          http://www.grid.net.ru/nginx/upload.en.html
        </div>
      </article>

      <article>
        <h1>Load Balancing on Rails</h1>
        <p>HAProxy <code>F5 BIG-IP</code></p>
      </article>

      <article>
        <h3>Preheat Rails Asset Cache</h3>
        <p>Rails Asset Cache</p>
        <p>merge multiple css or js files into one file</p>
        <p>decrease http requests</p>
        <p>processing view generate when it not exist</p>
        <p>Jammit</p>
        <p>capistrano deploy hook</p>
      </article>

      <article>
        <h3>Memcached Distribute and Failover</h3>
        <p>config/enviroments/production.rb</p>
        <section>
<pre>
MEMCACHE_SERVERS = ["192.168.100.3:11211", "192.168.100.4:11211"]
config.cache_store = :mem_cache_store, MEMCACHE_SERVERS, {
  :namespace => "techbang"
}</pre>
        </section>
      </article>

      <article>
        <h1>Rails Backup Solution</h1>
        <p>Whenever + Backup Gems</p>
      </article>

      <article>
        <h1 class="upper">Whenever</h1>
        <p>Cron jobs in Ruby</p>
        <p>
          Linux Crontab Format<br/>
          # min hour dom mon dow command
        </p>
        <table>
          <tr>
            <td>
              every :hour
            <td>
              every 3.hours
            <td>
              every 1.hour, :at => 30
          <tr>
            <td colspan="2">
              every 1.day, :at => '4:30 am'
            <td>
              every '0 0 27-31 * *'
        </table>
      </article>

      <article>
        <h1 class="upper">Whenever</h1>
        <p>job_type: command, rake task</p>
<pre>
# whenever config/schedule.rb
every 1.day, :at => "23:45" do
  command "echo 'Say Hello!'"
  rake "mail:notification"
end
# generated crontab
45 23 * * * /bin/bash -l -c 'echo '\''Say Hello!'\'''
45 23 * * * /bin/bash -l -c 'cd project && \
RAILS_ENV=production bundle exec rake mail:notification'</pre>
      </article>

      <article>
        <h1 class="upper">Whenever</h1>
        <p>Capistrano integration, update crontab with deploy</p>
<pre>
# config/deploy.rb
set :whenever_command, "bundle exec whenever"
require "whenever/capistrano"</pre>
        <div class="source">
          http://rubygems.org/gems/whenever
        </div>
      </article>

      <article>
        <h1 class="upper">Backup (RubyGem)</h1>
        <ul class="build">
          <li>Database: MySQL, PostgreSQL, MongoDB, Redis</li>
          <li>Backup Type: RSync, Tar archive (Gzip, Bzip2)</li>
          <li>Cloud Storage: S3, Dropbox, Rackspace Cloud</li>
          <li>Remote Servers (FTP, SFTP, SCP and RSync)</li>
          <li>Notifiers: Mail, Twitter, Campfire, Presently</li>
        </ul>
      </article>

      <article>
        <h3>Backup (RubyGem)</h3>
        <p>backup perform -t local_backup</p>
<pre>
Backup::Model.new(:local_backup, "Backup!") do
  backup_path = "/mnt/backup_copy/project"
  backup_list = []
  backup_list << "/home/rails/project/shared/system"
  backup_list << "/home/rails/project/shared/config"

  if File.directory? backup_path
    system("rsync -ravh --delete #{backup_list.join(" ")} #{backup_path}")
  end
end</pre>
        <p>Backup has a <code>great wiki</code>, explains each component in detail with many examples.</p>
        <div class="source">
          http://rubygems.org/gems/backup
        </div>
      </article>

      <article>
        <h3>Backup Target</h3>
<pre>
project/
├── current -> /home/rails/project/releases/20110819032217
├── releases
│   ├── 20110728073852
│   ├── ...
│   └── 20110819032217
└── shared
    ├── bundle
    ├── cached-copy
    ├── <span class="red">config</span> => current/config/database.yml
    ├── log
    ├── pids
    └── <span class="red">system</span> => current/public/system</pre>
      </article>

      <article>
        <h3 class="upper">Configuration Stay with Project</h3>
        <table>
          <tr>
            <td>
              Whenever
            <td>
              config/schedule.rb
          <tr>
            <td>
              Backup
            <td>
              config/backup.rb
        </table>
        <p>backup run at one main server only</p>
<pre>
# config/schedule.rb
host = `hostname`.chomp
if host == "main_server"
  command "cd /home/rails/project/current && \
  AWS_CALLING_FORMAT=SUBDOMAIN backup perform -t local_backup \
  --config_file 'config/backup.rb'"
end
</pre>
      </article>

      <article>
        <h1>Q & A</h1>
        <h2>Thanks!</h2>
      </article>

    </section>

  </body>
</html>
